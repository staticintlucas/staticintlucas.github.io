<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>stringslice</title>
<link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,300;0,500;1,300;1,500&amp;family=Fira+Mono&amp;family=Montserrat:ital,wght@0,700;1,700&amp;display=swap" rel="stylesheet">

<link rel="apple-touch-icon" sizes="180x180" href="/assets/icon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/icon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/icon/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/assets/icon/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#6099a9">
<meta name="theme-color" content="#1e1e1e">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="stringslice" />
<meta name="author" content="Lucas Jansen" />
<meta property="og:locale" content="en_IE" />
<meta name="description" content="stringslice" />
<meta property="og:description" content="stringslice" />
<link rel="canonical" href="https://staticintlucas.github.io/projects/stringslice/" />
<meta property="og:url" content="https://staticintlucas.github.io/projects/stringslice/" />
<meta property="og:site_name" content="Lucas Jansen" />
<meta property="og:image" content="https://staticintlucas.github.io/assets/img/homepage.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-03-02T20:38:31+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:image" content="https://staticintlucas.github.io/assets/img/homepage.png" />
<meta property="twitter:title" content="stringslice" />
<meta name="twitter:site" content="@staticintlucas" />
<meta name="twitter:creator" content="@Lucas Jansen" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Lucas Jansen"},"dateModified":"2022-03-02T20:38:31+00:00","datePublished":"2022-03-02T20:38:31+00:00","description":"stringslice","headline":"stringslice","image":"https://staticintlucas.github.io/assets/img/homepage.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://staticintlucas.github.io/projects/stringslice/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://staticintlucas.github.io/assets/img/homepage.png"},"name":"Lucas Jansen"},"url":"https://staticintlucas.github.io/projects/stringslice/"}</script>
<!-- End Jekyll SEO tag -->


        <link rel="stylesheet" href="/assets/css/style.css">
    </head>
    <body>
        <header>
    <nav>
        <ul>
            
            <li><a href="/" class="title noline"><u>Lucas Jansen</u></a>
            <li><a href="/projects" class="noline">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-code" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                    <polyline points="7 8 3 12 7 16"></polyline>
                    <polyline points="17 8 21 12 17 16"></polyline>
                    <line x1="14" y1="4" x2="10" y2="20"></line>
                </svg>&ensp;<u>Projects</u></a>
            <li><a href="https://github.com/staticintlucas" class="noline">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                    <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"></path>
                </svg>&ensp;<u>Github</u></a>
            <li><a href="https://www.linkedin.com/in/ljansen0/" class="noline">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                    <rect x="4" y="4" width="16" height="16" rx="2"></rect>
                    <line x1="8" y1="11" x2="8" y2="16"></line>
                    <line x1="8" y1="8" x2="8" y2="8.01"></line>
                    <line x1="12" y1="16" x2="12" y2="11"></line>
                    <path d="M16 16v-3a2 2 0 0 0 -4 0"></path>
                </svg>&ensp;<u>LinkedIn</u></a>
        </ul>
    </nav>
</header>

        <main>
            <article>
                <h1 id="stringslice">stringslice</h1>

                <p><code class="language-plaintext highlighter-rouge">stringslice</code> is a simple Rust utility that provides Unicode-aware slicing of stings.</p>

<p>In Rust, all <code class="language-plaintext highlighter-rouge">String</code> and <code class="language-plaintext highlighter-rouge">&amp;str</code> variables must contain valid UTF-8 data.
There are other types of string intended for interfacing with C and with the operating system, but for general text processing these ‘regular’ UTF-8 strings are used.</p>

<p>UFT-8 encodes Unicode code points using a variable width encoding.
The first 128 characters are encoded the same as their 7-bit ASCII representation.
This was chosen in order to maintain backwards compatibility, but it also reduces the memory required to store strings in English (or other languages using the Latin script) when compared to UTF-16 or UTF-32.
Other characters — such as accented letters, non-latin alphabets, less common symbols, emojis, etc — use multiple bytes per code point.
The encoding is shown in the table below:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: right">From</th>
      <th style="text-align: right">To</th>
      <th style="text-align: left">Bytes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">U+0000</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">U+007F</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">0XXXXXXX</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">U+0080</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">U+07FF</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">110XXXXX 10XXXXXX</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">U+0800</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">U+FFFF</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">1110XXXX 10XXXXXX 10XXXXXX</code></td>
    </tr>
    <tr>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">U+10000</code></td>
      <td style="text-align: right"><code class="language-plaintext highlighter-rouge">U+10FFFF</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">11110XXX 10XXXXXX 10XXXXXX 10XXXXXX</code></td>
    </tr>
  </tbody>
</table>

<p>This encoding makes operations such as determining the number of characters in the string non-trivial.
With Rust’s philosophy of providing zero-cost abstractions, there is no built-in method to perform these operations.
Luckily, for counting the number of characters there is a simple method.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">let</span> <span class="n">length</span> <span class="o">=</span> <span class="n">string</span><span class="nf">.chars</span><span class="p">()</span><span class="nf">.count</span><span class="p">();</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Here, the <code class="language-plaintext highlighter-rouge">chars()</code> method creates an iterator over UTF-8 code points.
The <code class="language-plaintext highlighter-rouge">count()</code> method takes characters from the iterator until it reaches the end, returning the count.
Of course, iterating over any sequence has complexity O(n), regardless of whether the data is UFT-8 encoded or not.
By forcing you to create an iterator explicitly, Rust makes it obvious that this is not a simple constant-time operation.</p>

<p>However, for taking a slice of a string Rust does allow indexing.
For example, you can run the following code:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">let</span> <span class="n">string</span> <span class="o">=</span> <span class="s">"abcdef"</span><span class="p">;</span>
<span class="k">let</span> <span class="n">slice</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">string</span><span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">4</span><span class="p">];</span>

<span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">slice</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This compiles and runs as expected, printing out the result:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>bcd
</pre></td></tr></tbody></table></code></pre></div></div>

<p>However, slicing a string like this uses <em>bytes</em> as indices, not code points.
In that example there were only ASCII characters, so each code point is only one byte.
On the other hand, consider this example where the string contains an emoji which is a single code point encoded as 4 bytes:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="k">let</span> <span class="n">string</span> <span class="o">=</span> <span class="s">"ab😎ef"</span><span class="p">;</span>
<span class="k">let</span> <span class="n">slice</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">string</span><span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">4</span><span class="p">];</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Running this produces the following result:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>thread 'main' panicked at 'byte index 4 is not a char boundary; it is inside '😎' (bytes 2..6) of `ab😎ef`'
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The program attempted to slice the string in the middle of the UTF-8 sequence for ‘😎’.
This would have produced an invalid string.
Rust does check whether the resulting string would be valid; if the string is not valid it causes a <code class="language-plaintext highlighter-rouge">panic</code> and the program exits.</p>

<p>I created this project because I had fallen into this trap in the past.
The <code class="language-plaintext highlighter-rouge">stringslice</code> crate provides a <code class="language-plaintext highlighter-rouge">StringSlice</code> trait which allows a string to be sliced correctly regardless of the characters it contains.
Internally it uses a similar method to the <code class="language-plaintext highlighter-rouge">chars()</code> iterator I described previously.
It actually uses <code class="language-plaintext highlighter-rouge">char_indices()</code> to find the position (in bytes) of each character in the string.
Using those byte positions it can correctly slice the string on the correct UTF-8 boundaries.</p>

<p>Here is the previous example, modified to use <code class="language-plaintext highlighter-rouge">stringslice</code>:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="k">use</span> <span class="nn">stringslice</span><span class="p">::</span><span class="n">StringSlice</span><span class="p">;</span>

<span class="k">let</span> <span class="n">string</span> <span class="o">=</span> <span class="s">"ab😎ef"</span><span class="p">;</span>
<span class="k">let</span> <span class="n">slice</span> <span class="o">=</span> <span class="n">string</span><span class="nf">.slice</span><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">4</span><span class="p">);</span>

<span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">slice</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This does not <code class="language-plaintext highlighter-rouge">panic</code>, and more importantly prints out the expected result:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>b😎e
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Ultimately the project is pretty trivial; it’s only around 50 lines of code if you exclude blank lines, comments, and unit tests.
However, I find it useful for my own projects, and I thought maybe someone else would too.</p>

<p>Source code is available on <a href="https://github.com/staticintlucas/stringslice">GitHub</a>, and the crate is available on <a href="https://crates.io/crates/stringslice">crates.io</a>.</p>


            </article>
            <footer>
    &copy; 2020-2021 Lucas Jansen. All rights reserved. Website content, excluding visual design, is
    licensed under <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">cc by-sa</a>.
</footer>

        </main>
    </body>
</html>
